{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Profile - We Donate</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: 80px;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            color: #667eea !important;
        }
        
        .navbar-nav .nav-link {
            color: #333 !important;
            font-weight: 500;
            margin: 0 10px;
            transition: color 0.3s ease;
        }
        
        .navbar-nav .nav-link:hover {
            color: #667eea !important;
        }
        
        .dropdown-menu {
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .dropdown-item {
            padding: 10px 20px;
            transition: all 0.3s ease;
        }
        
        .dropdown-item:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .main-container {
            padding: 2rem 0;
        }
        
        .profile-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease;
        }
        
        .profile-card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: none !important;
            border: none;
            padding: 0 0 1.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }
        
        .edit-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            padding: 8px 20px;
            border-radius: 25px;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .edit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            font-weight: 500;
            color: #555;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .form-group label i {
            margin-right: 8px;
            color: #667eea;
        }
        
        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            background: white;
        }
        
        .form-control:disabled {
            background: rgba(248, 249, 250, 0.8);
            border-color: #dee2e6;
        }
        
        .btn-update {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .btn-update:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .btn-update:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .password-strength {
            margin-top: 5px;
            font-size: 12px;
        }
        
        .strength-weak { color: #dc3545; }
        .strength-medium { color: #ffc107; }
        .strength-strong { color: #28a745; }
        
        .password-match {
            margin-top: 5px;
            font-size: 12px;
        }
        
        .match-success { color: #28a745; }
        .match-error { color: #dc3545; }
        
        .success-message {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .footer {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-top: 3rem;
        }
        
        .footer a {
            color: #ecf0f1;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer a:hover {
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }
            
            .profile-card {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container">
            <a class="navbar-brand" href="{% url 'donor-landing-page' %}">
                <i class="fas fa-heart text-danger"></i> We Donate
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'donor-landing-page' %}">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'donor-home' %}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'book-appointment' %}">Book Appointment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'new-donation-request' %}">New Request</a>
                    </li>
                </ul>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="settingsDropdown" data-toggle="dropdown">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="{% url 'donor-profile-update' %}">
                                <i class="fas fa-user"></i> Profile
                            </a>
                            <a class="dropdown-item" href="#" onclick="scrollToPasswordSection()">
                                <i class="fas fa-lock"></i> Change Password
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="{% url 'donor-logout' %}">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container main-container">
        <div class="row">
            <!-- Profile Information Card -->
            <div class="col-lg-6 col-md-12">
                <div class="profile-card">
                    <div class="card-header">
                        <h4 class="card-title">
                            <i class="fas fa-user-circle"></i> Profile Information
                        </h4>
                        <button class="btn edit-btn" type="button" onclick="enableEditProfile()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    
                    <form method="POST" action="{% url 'donor-profile-update' %}" id="profileForm">
                        {% csrf_token %}
                        
                        {% if success and pfcheck %}
                        <div class="success-message">
                            <i class="fas fa-check-circle"></i> {{ msg }}
                        </div>
                        {% endif %}
                        
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> Full Name</label>
                            <input type="text" name="donor_name" value="{{ donor.first_name }}" id="donorName" class="form-control" required disabled>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-envelope"></i> Email Address</label>
                            <input type="email" class="form-control" name="email" id="email" value="{{ donor.email }}" disabled required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label><i class="fas fa-city"></i> City</label>
                                <input type="text" id="city" name="city" class="form-control" value="{{ donor.city }}" disabled>
                            </div>
                            <div class="form-group col-md-6">
                                <label><i class="fas fa-map-marker-alt"></i> Province</label>
                                <select id="province" name="province" class="form-control" disabled>
                                    <option value="Nova Scotia"{% if provinces.0 %} selected{% endif %}>Nova Scotia</option>
                                    <option value="British Columbia"{% if provinces.1 %} selected{% endif %}>British Columbia</option>
                                    <option value="Ontario"{% if provinces.2 %} selected{% endif %}>Ontario</option>
                                    <option value="Quebec"{% if provinces.3 %} selected{% endif %}>Quebec</option>
                                    <option value="Alberta"{% if provinces.4 %} selected{% endif %}>Alberta</option>
                                    <option value="New Brunswick"{% if provinces.5 %} selected{% endif %}>New Brunswick</option>
                                    <option value="Manitoba"{% if provinces.6 %} selected{% endif %}>Manitoba</option>
                                    <option value="Saskatchewan"{% if provinces.7 %} selected{% endif %}>Saskatchewan</option>
                                    <option value="Newfoundland and Labrador"{% if provinces.8 %} selected{% endif %}>Newfoundland and Labrador</option>
                                    <option value="Prince Edward Island"{% if provinces.9 %} selected{% endif %}>Prince Edward Island</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label><i class="fas fa-phone"></i> Contact Number</label>
                                <input type="text" id="contact" name="contact" class="form-control" maxlength="10" minlength="10" value="{{ donor.contact_number }}" placeholder="+1 (xxx) xxx-xxxx" disabled>
                            </div>
                            <div class="form-group col-md-6">
                                <label><i class="fas fa-flag"></i> Country</label>
                                <select id="country" name="country" class="form-control" disabled>
                                    <option selected>Canada</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button name="profile" type="submit" id="updateProfileBtn" class="btn btn-update" disabled>
                                <i class="fas fa-save"></i> Update Profile
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- Password Change Card -->
            <div class="col-lg-6 col-md-12" id="passwordSection">
                <div class="profile-card">
                    <div class="card-header">
                        <h4 class="card-title">
                            <i class="fas fa-lock"></i> Change Password
                        </h4>
                        <button class="btn edit-btn" type="button" onclick="enableEditPassword()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    
                    <form method="POST" action="{% url 'donor-profile-update' %}" id="passwordForm">
                        {% csrf_token %}
                        
                        {% if success and pscheck %}
                        <div class="success-message">
                            <i class="fas fa-check-circle"></i> {{ msg }}
                        </div>
                        {% endif %}
                        
                        <div class="form-group">
                            <label><i class="fas fa-key"></i> Current Password</label>
                            <input type="password" id="oldPassword" name="old_password" class="form-control" disabled required>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-lock"></i> New Password</label>
                            <input class="form-control" type="password" name="new_password" id="newPassword" minlength="6" pattern="(?=.*[a-z])(?=.*\d).{6,}" title="Password must contain at least 6 characters with 1 lowercase letter and 1 digit" disabled required oninput="checkPasswordStrength()">
                            <div id="passwordStrength" class="password-strength"></div>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-lock"></i> Confirm New Password</label>
                            <input class="form-control" type="password" id="confirmPassword" disabled required oninput="checkPasswordMatch()">
                            <div id="passwordMatch" class="password-match"></div>
                        </div>
                        
                        <div class="form-group">
                            <button name="password" type="submit" id="updatePasswordBtn" class="btn btn-update" disabled>
                                <i class="fas fa-shield-alt"></i> Update Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 We Donate Inc. All rights reserved. | 
                <a href="#">About Us</a> | 
                <a href="#">Contact Us</a> | 
                <a href="#">Privacy Policy</a>
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <script>
        // Enable profile editing
        function enableEditProfile() {
            const fields = ['donorName', 'email', 'city', 'province', 'contact', 'country'];
            fields.forEach(field => {
                document.getElementById(field).disabled = false;
            });
            document.getElementById('updateProfileBtn').disabled = false;
            
            Swal.fire({
                icon: 'info',
                title: 'Edit Mode Enabled',
                text: 'You can now edit your profile information.',
                timer: 2000,
                showConfirmButton: false
            });
        }
        
        // Enable password editing
        function enableEditPassword() {
            const fields = ['oldPassword', 'newPassword', 'confirmPassword'];
            fields.forEach(field => {
                document.getElementById(field).disabled = false;
            });
            document.getElementById('updatePasswordBtn').disabled = false;
            
            Swal.fire({
                icon: 'info',
                title: 'Password Edit Mode',
                text: 'You can now change your password.',
                timer: 2000,
                showConfirmButton: false
            });
        }
        
        // Check password strength
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthDiv = document.getElementById('passwordStrength');
            
            if (password.length === 0) {
                strengthDiv.innerHTML = '';
                return;
            }
            
            let strength = 0;
            let feedback = [];
            
            if (password.length >= 8) strength++;
            else feedback.push('at least 8 characters');
            
            if (/[a-z]/.test(password)) strength++;
            else feedback.push('lowercase letter');
            
            if (/[A-Z]/.test(password)) strength++;
            else feedback.push('uppercase letter');
            
            if (/\d/.test(password)) strength++;
            else feedback.push('number');
            
            if (/[^\w\s]/.test(password)) strength++;
            else feedback.push('special character');
            
            if (strength < 3) {
                strengthDiv.innerHTML = '<span class="strength-weak"><i class="fas fa-times-circle"></i> Weak - Add: ' + feedback.join(', ') + '</span>';
            } else if (strength < 4) {
                strengthDiv.innerHTML = '<span class="strength-medium"><i class="fas fa-exclamation-circle"></i> Medium - Consider adding: ' + feedback.join(', ') + '</span>';
            } else {
                strengthDiv.innerHTML = '<span class="strength-strong"><i class="fas fa-check-circle"></i> Strong password!</span>';
            }
        }
        
        // Check password match
        function checkPasswordMatch() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const matchDiv = document.getElementById('passwordMatch');
            
            if (confirmPassword.length === 0) {
                matchDiv.innerHTML = '';
                return;
            }
            
            if (newPassword === confirmPassword) {
                matchDiv.innerHTML = '<span class="match-success"><i class="fas fa-check-circle"></i> Passwords match!</span>';
            } else {
                matchDiv.innerHTML = '<span class="match-error"><i class="fas fa-times-circle"></i> Passwords do not match</span>';
            }
        }
        
        // Scroll to password section
        function scrollToPasswordSection() {
            document.getElementById('passwordSection').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
        
        // Form submission with confirmation
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            Swal.fire({
                title: 'Update Profile?',
                text: 'Are you sure you want to update your profile information?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#667eea',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, update it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    this.submit();
                }
            });
        });
        
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                Swal.fire({
                    icon: 'error',
                    title: 'Password Mismatch',
                    text: 'New password and confirm password do not match!'
                });
                return;
            }
            
            Swal.fire({
                title: 'Change Password?',
                text: 'Are you sure you want to change your password?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#667eea',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, change it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    this.submit();
                }
            });
        });
        
        // Format phone number input
        document.getElementById('contact').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 6) {
                value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{3})(\d+)/, '($1) $2');
            }
            e.target.value = value;
        });
    </script>
</body>
</html>
